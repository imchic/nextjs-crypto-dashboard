# 2026-02-23 - Crypto Dashboard Development Session

## Summary
Extensive UI/UX improvements to Next.js crypto dashboard with split-panel layout, chart restoration, and portfolio integration.

## Major Features Completed

### 1. Chart & Data Restoration
- **Problem**: Charts disappeared after split-panel implementation
- **Solution**: Created reusable `CoinDetailPanel.js` component extracting all chart logic from `pages/coin/[symbol].js`
- **Features restored**:
  - 11 candle types (1Î∂Ñ~ÏõîÎ¥â) with horizontal scrollable tabs
  - Real-time candlestick chart with proper data transformation
  - Orderbook (Ìò∏Í∞ÄÏ∞Ω) - converted to horizontal 1:1 layout (Îß§ÎèÑÏ¢å/Îß§ÏàòÏö∞)
  - Trade history (Ï≤¥Í≤∞ÎÇ¥Ïó≠)
  - 3-second auto-refresh

### 2. Split-Panel Layout
- **Initial state**: Full-width coin list (max 1200px, centered)
- **On coin click**: Split to 45% detail (left) + 55% list (right)
- **Close button (‚úï)**: Returns to full layout
- **No page navigation**: State-based panel display
- **Classes**: `.fullLayout`, `.splitLayout`, `.detailPanel`, `.listPanel`

### 3. Global Header Consolidation
- **Moved to header**: Date/time + refresh button (from dashboard local header)
- **Implementation**: Context API (`DashboardContext` in `Layout.js`)
- **Structure**: `[ÎèåÎèåÏù¥ ÏΩîÏù∏Ìåê] ... [timestamp] [üîÑ] [üåô]`
- **Button sizes**: Unified to 38x38px (refresh icon 16px, theme icon 20px)

### 4. Chart Tooltip Enhancement
- **Design**: Glassmorphism with backdrop blur, 12px border-radius
- **Layout**: Label | Value (justified), monospace for numbers
- **Colors**: 
  - High: #0ECB81 (green)
  - Low: #F6465D (red)
  - Close: Dynamic (up/down)
- **Added**: Change percentage at bottom with separator

### 5. Portfolio Page (`/portfolio`)
- **Created**: New page for "üí∞ ÎÇ¥ÏßÄÍ∞ë" integration
- **Features**:
  - Total asset summary card (gradient)
  - Grid layout for account cards
  - Shows: balance, locked, avg price, evaluated value
  - Filters out zero-balance accounts
- **API**: `/api/upbit-accounts` using JWT auth
- **Config**: Loads from `.env.local` (UPBIT_ACCESS_KEY, UPBIT_SECRET_KEY)

### 6. Theme & Styling Fixes
- **ÎèåÎèåÏù¥ÌîΩ cards**: Fixed light mode text visibility with CSS variables
  - `.pickText`: `var(--text-secondary)`
  - `.pickText strong`: `var(--text-primary)`
  - `.pickText p`: `var(--text-tertiary)`

## Technical Decisions

### Data Transformation (Candles)
```js
// Raw Upbit API ‚Üí Chart format
{
  time: localeTimeString,
  open, close, high, low,
  wickHigh: high - max(open,close),
  body: abs(close - open),
  wickLow: min(open,close) - low
}
```

### Orderbook API Parsing
- Upbit returns `[{orderbook_units: [...]}]` array
- Extract `data[0]` for display
- Added null checks: `orderbook && orderbook.orderbook_units`

### Context Structure
```js
DashboardContext.Provider({
  dashboardState: {
    timestamp: ISO string,
    loading: boolean,
    onRefresh: function
  },
  setDashboardState: updater
})
```

## File Changes (2026-02-23 Session 2)

### New Files
- `components/CoinDetailPanel.js` - Reusable detail component with charts
- `pages/portfolio.js` - Portfolio page with wallet integration
- `styles/portfolio.module.css` - Portfolio styles

### Modified Files
- `components/Layout.js` - Added Context, timestamp/refresh in header
- `styles/Layout.module.css` - Header right section, button styles, animations
- `pages/index.js` - Split layout logic, removed local header, Context integration
- `styles/dashboard.module.css` - `.fullLayout`, `.pickText` color fixes
- `styles/CoinDetail.module.css` - `.tooltip` styles, orderbook grid layout
- `pages/api/upbit-accounts.js` - Switched from file config to env vars
- `.env.local` - Stored Upbit API credentials

### Key Code Patterns

**Split Layout Toggle:**
```jsx
<div className={selectedCoin ? styles.splitLayout : styles.fullLayout}>
  {selectedCoin && <div className={styles.detailPanel}>...</div>}
  <div className={styles.listPanel}>...</div>
</div>
```

**Context Usage in Dashboard:**
```js
const { setDashboardState } = useContext(DashboardContext);

// On mount
setDashboardState({
  timestamp: null,
  loading: false,
  onRefresh: () => { loadData(true); showToast('‚úÖ ÏÉàÎ°úÍ≥†Ïπ®!'); }
});

// In loadData
setDashboardState(prev => ({ ...prev, timestamp: newTimestamp, loading: false }));
```

## Known Issues & Constraints
- Portfolio requires Upbit API keys in `.env.local`
- Server restart needed after `.env.local` changes
- Session: `brisk-glade` (pid 15554, port 3000)

## User Preferences
- Korean UI/communication
- Minimal, clean design (Notion/Toss style)
- No emojis in UI (React Icons preferred)
- Immediate visual feedback
- Single-page experience (state over navigation)

## Next Steps (Suggested)
- Add current price to detail panel header
- Implement keyboard shortcuts (ESC to close, arrows to navigate)
- Mobile responsive layout (stack panels on small screens)
- Add mini-chart preview in list rows
- Performance: React.memo for coin rows
- Portfolio: Add P&L (profit/loss) calculations with real-time price
